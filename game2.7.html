<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LAVA RUSH â†’ GREEN OASIS (EASIER)</title>
  <style>
    body { margin:0; overflow:hidden; background:#000; font-family:system-ui, sans-serif; }
    #hud {
      position: fixed; top: 12px; left: 12px; color: #fffef0; background: rgba(30,20,0,0.82);
      padding: 10px 16px; border-radius: 12px; border: 1px solid #ff8800cc; z-index: 10;
      box-shadow: 0 6px 18px #000000cc;
    }
    #status {
      position: fixed; bottom: 16px; left: 50%; transform: translateX(-50%);
      background: rgba(40,20,0,0.88); color: #ffe; padding: 12px 24px; border-radius: 12px;
      border: 1px solid #ff7700cc; min-width: 340px; text-align: center; z-index: 10;
    }
    #speedIndicator {
      position: fixed; top: 80px; left: 12px; color: #ffeb99;
      background: rgba(40,20,0,0.82); padding: 8px 14px; border-radius: 10px;
      border: 1px solid #ffaa00cc; z-index: 10; font-weight: bold;
    }
    canvas { display:block; }
    #startOverlay, #winOverlay {
      position: fixed; inset: 0; display: flex; flex-direction: column;
      justify-content: center; align-items: center; z-index: 100; color: #fffef0;
      background: radial-gradient(circle at top, #ff550055 0%, #000000ee 60%);
      text-align: center; padding: 20px;
    }
    #startOverlay h1, .win-title {
      font-size: 4.2em; margin: 0.1em 0; color: #ffcc33;
      text-shadow: 0 0 45px #ff8800, 0 0 90px #cc4400;
    }
    .buttons-container {
      display: flex; flex-wrap: wrap; justify-content: center; gap: 50px;
      margin-top: 40px;
    }
    button {
      padding: 22px 70px; font-size: 1.7em; border-radius: 16px; cursor: pointer;
      color: white; border: 3px solid; transition: all 0.28s;
      min-width: 280px;
    }
    button:hover { transform: scale(1.1); box-shadow: 0 0 60px; }
    #restartWin {
      background: #ff5500; border-color: #ffaa66; box-shadow: 0 0 45px #ff7700dd;
    }
    #toGameCenter {
      background: #228822; border-color: #55ff55; box-shadow: 0 0 45px #44cc44aa;
    }
    .hit-flash {
      position: fixed; inset: 0; pointer-events: none; opacity: 0; z-index: 20;
      background: radial-gradient(circle, rgba(255,100,10,0.7) 0%, transparent 70%);
      transition: opacity 0.35s;
    }
    .hit-flash.active { opacity: 1; animation: shake 0.65s; }
    @keyframes shake {
      0%,100%{transform:translate(0,0)} 20%{transform:translate(-10px,5px)}
      40%{transform:translate(10px,-5px)} 60%{transform:translate(-6px,6px)} 80%{transform:translate(6px,-6px)}
    }
  </style>
</head>
<body>
<div class="hit-flash" id="hitFlash"></div>

<div id="startOverlay">
  <h1>LAVA â†’ GREEN OASIS</h1>
  <p style="font-size:1.6em; max-width:700px; line-height:1.5;">
    Enjoy the winding road with fewer obstacles!<br>
    Reach the safe green paradise at the end ğŸŒ‹â†’ğŸŒ¿
  </p>
  <p><strong>Controls:</strong><br>
  â€¢ Left half â†’ steer left<br>
  â€¢ Right half â†’ steer right<br>
  â€¢ Both halves â†’ brake</p>
  <button id="startButton">START THE JOURNEY ğŸ”¥</button>
</div>

<div id="winOverlay" style="display:none;">
  <div class="win-title">YOU REACHED THE GREEN OASIS! ğŸŒ¿âœ¨</div>
  <p style="font-size:2.1em; margin:28px 0; color:#aaffaa;">
    Amazing journey! You escaped the lava and found paradise.
  </p>
  
  <div class="buttons-container">
    <button id="restartWin">PLAY AGAIN ğŸ”¥</button>
    <button id="toGameCenter">CONTINUE TO GAME CENTER â†’</button>
  </div>
</div>

<div id="hud">
  <div><b>â† Left halfâ€ƒâ€ƒâ†’ Right halfâ€ƒâ€ƒBoth = Brake</b></div>
  <div>Lava Road â†’ Green Oasis (easier)</div>
</div>

<div id="status">Enjoy the ride to the green zone... <button id="btn" style="margin-left:16px;">Restart</button></div>
<div id="speedIndicator">Speed: 0 km/h</div>

<script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let gameStarted = false, won = false;
const hitFlash = document.getElementById('hitFlash');
const startOverlay = document.getElementById('startOverlay');
const winOverlay = document.getElementById('winOverlay');
const status = document.getElementById('status');
const speedDisplay = document.getElementById('speedIndicator');

// â”€â”€â”€ THREE SETUP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setPixelRatio(Math.min(2.5, window.devicePixelRatio));
renderer.shadowMap.enabled = true;
renderer.shadowMap.type = THREE.PCFSoftShadowMap;
renderer.toneMapping = THREE.ACESFilmicToneMapping;
renderer.toneMappingExposure = 1.45;
document.body.appendChild(renderer.domElement);

const scene = new THREE.Scene();
scene.background = new THREE.Color(0x66ddff);
scene.fog = new THREE.FogExp2(0x77aaff, 0.0013);

const camera = new THREE.PerspectiveCamera(74, innerWidth/innerHeight, 0.1, 1000);
camera.position.set(0, 4.8, 6.5);

// Lighting
scene.add(new THREE.AmbientLight(0xffffff, 0.65));
const sun = new THREE.DirectionalLight(0xffeebb, 2.3);
sun.position.set(70, 120, 60);
sun.castShadow = true;
sun.shadow.mapSize.set(2048,2048);
scene.add(sun);

// â”€â”€â”€ CAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const car = new THREE.Group();
scene.add(car);

const body = new THREE.Mesh(
  new THREE.BoxGeometry(2.95, 1.0, 1.75),
  new THREE.MeshStandardMaterial({color:0xff0044, metalness:0.45, roughness:0.35})
);
car.add(body);

const cabin = new THREE.Mesh(
  new THREE.BoxGeometry(2.0, 0.95, 1.45),
  new THREE.MeshStandardMaterial({color:0xffdd11, roughness:0.55})
);
cabin.position.y = 1.0;
car.add(cabin);

const wheelGeo = new THREE.CylinderGeometry(0.52,0.52,0.42,22);
const wheelMat = new THREE.MeshStandardMaterial({color:0x080808, metalness:0.97});
const wheelPos = [[-1.3,0,0.9], [1.3,0,0.9], [-1.3,0,-0.9], [1.3,0,-0.9]];
const wheels = [];
wheelPos.forEach(p => {
  const w = new THREE.Mesh(wheelGeo, wheelMat);
  w.rotation.z = Math.PI/2;
  w.position.set(...p);
  car.add(w);
  wheels.push(w);
});
car.position.y = 0.52;

// â”€â”€â”€ WORLD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const ground = new THREE.Mesh(
  new THREE.PlaneGeometry(1400, 500),
  new THREE.MeshStandardMaterial({color:0x111000, roughness:0.88})
);
ground.rotation.x = -Math.PI/2;
ground.receiveShadow = true;
scene.add(ground);

// Lava glow
const lavaPlane = new THREE.Mesh(
  new THREE.PlaneGeometry(1000, 500),
  new THREE.MeshBasicMaterial({color:0xff2200, transparent:true, opacity:0.85})
);
lavaPlane.rotation.x = -Math.PI/2;
lavaPlane.position.y = -0.15;
scene.add(lavaPlane);

// â”€â”€â”€ ROAD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const lavaRoadMat = new THREE.MeshStandardMaterial({color:0x881100, roughness:0.7});
const greenRoadMat = new THREE.MeshStandardMaterial({color:0x228822, roughness:0.65});
const roadWidth = 20;

for(let i = -100; i < 380; i += 6) {
  const curve = Math.sin(i * 0.11) * 32 + Math.cos(i * 0.165) * 18;
  const isGreen = i > 280;
  const mat = isGreen ? greenRoadMat : lavaRoadMat;
 
  const seg = new THREE.Mesh(new THREE.PlaneGeometry(roadWidth + 8, 8), mat);
  seg.rotation.x = -Math.PI/2;
  seg.position.set(i, 0.07, curve);
  scene.add(seg);
}

// Dashed line
const lavaDashMat = new THREE.MeshBasicMaterial({color:0xffff77});
const greenDashMat = new THREE.MeshBasicMaterial({color:0x88ff88});

for(let i = -100; i < 380; i += 5) {
  const curve = Math.sin(i * 0.11) * 32 + Math.cos(i * 0.165) * 18;
  const mat = i > 280 ? greenDashMat : lavaDashMat;
 
  const d = new THREE.Mesh(new THREE.PlaneGeometry(7, 0.55), mat);
  d.rotation.x = -Math.PI/2;
  d.position.set(i, 0.14, curve);
  scene.add(d);
}

// â”€â”€â”€ FINISH GATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const finishGate = new THREE.Group();
const gateLeft = new THREE.Mesh(
  new THREE.BoxGeometry(2, 18, 2),
  new THREE.MeshStandardMaterial({color:0x00ff44, emissive:0x00aa22, emissiveIntensity:0.8})
);
gateLeft.position.set(350, 9, -12);
finishGate.add(gateLeft);

const gateRight = gateLeft.clone();
gateRight.position.z = 12;
finishGate.add(gateRight);

const gateTop = new THREE.Mesh(
  new THREE.BoxGeometry(30, 2, 2),
  new THREE.MeshStandardMaterial({color:0x00ff44, emissive:0x00aa22, emissiveIntensity:1.2})
);
gateTop.position.set(350, 18, 0);
finishGate.add(gateTop);

scene.add(finishGate);

// â”€â”€â”€ OBSTACLES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const obstacles = [];

function addRock(x, z, scale=1) {
  const h = 1.7 + Math.random()*1.2;
  const rock = new THREE.Mesh(
    new THREE.DodecahedronGeometry(1.8*scale, 1),
    new THREE.MeshStandardMaterial({color:0x2a2200, roughness:0.82})
  );
  rock.scale.set(1.7*scale, h*scale, 1.9*scale);
  rock.position.set(x, h*scale/2, z);
  rock.castShadow = true;
  scene.add(rock);
  obstacles.push(rock);
}

function addLavaGeyser(x, z) {
  const g = new THREE.Mesh(
    new THREE.CylinderGeometry(2.6, 4, 3.8, 14),
    new THREE.MeshBasicMaterial({color:0xff0000, transparent:true, opacity:0.9})
  );
  g.position.set(x, 1.9, z);
  scene.add(g);
  obstacles.push(g);
}

for(let i = -40; i < 260; i += 22) {
  const curve = Math.sin(i * 0.11) * 32 + Math.cos(i * 0.165) * 18;
  addRock(i + 8, curve - 10, 1.1);
  addRock(i + 8, curve + 10, 1.0);
  if (i % 60 < 15) {
    addLavaGeyser(i + 12, curve + (Math.random() > 0.5 ? 7 : -7));
  }
  if (i % 80 === 0) {
    addRock(i + 10, curve, 1.3);
  }
}

// â”€â”€â”€ INPUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let touchLeft = false, touchRight = false;
const zones = { left: document.createElement('div'), right: document.createElement('div') };
Object.values(zones).forEach(z => {
  z.style.cssText = 'position:fixed;top:0;bottom:0;opacity:0;z-index:5;';
  document.body.appendChild(z);
});
zones.left.style.width = '50%'; zones.left.style.left = '0';
zones.right.style.width = '50%'; zones.right.style.right = '0';

function toggleInput(el, setter) {
  ['touchstart','mousedown'].forEach(e=>el.addEventListener(e,ev=>{ev.preventDefault(); setter(true); if(!gameStarted) startGame();}));
  ['touchend','mouseup','mouseleave'].forEach(e=>el.addEventListener(e,()=>setter(false)));
}
toggleInput(zones.left, v=>touchLeft=v);
toggleInput(zones.right, v=>touchRight=v);

window.addEventListener('keydown', e=>{
  const k = e.key.toLowerCase();
  if(k==='a'||k==='arrowleft') touchLeft = true;
  if(k==='d'||k==='arrowright') touchRight = true;
  if(!gameStarted) startGame();
});
window.addEventListener('keyup', e=>{
  const k = e.key.toLowerCase();
  if(k==='a'||k==='arrowleft') touchLeft = false;
  if(k==='d'||k==='arrowright') touchRight = false;
});

// â”€â”€â”€ GAME LOGIC â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let heading = 0, speed = 0;
const BASE_SPEED = 20, BRAKE_SPEED = 0, TURN_SPEED = 3.3;

function reset() {
  car.position.set(-80, 0.52, Math.sin(-80 * 0.11) * 32 + Math.cos(-80 * 0.165) * 18);
  heading = 0; car.rotation.y = 0; speed = 0; won = false;
  status.textContent = "Reach the green oasis!";
}

function startGame() {
  gameStarted = true;
  startOverlay.style.display = 'none';
  reset();
}

document.getElementById('startButton').onclick = startGame;
document.getElementById('btn').onclick = reset;

// Win screen buttons
document.getElementById('restartWin').onclick = () => {
  winOverlay.style.display = 'none';
  reset();
  gameStarted = true;
};

document.getElementById('toGameCenter').onclick = () => {
  window.location.href = 'g.html';
  // Alternative: window.open('dashboard.html', '_blank');
};

function checkCollision() {
  const p = car.position;
  for(const o of obstacles){
    if(p.distanceTo(o.position) < 5.6){
      hitFlash.classList.add('active');
      setTimeout(()=>hitFlash.classList.remove('active'), 800);
      status.textContent = "HIT OBSTACLE! â†’ Restarting...";
      setTimeout(reset, 1000);
      return true;
    }
  }
  return false;
}

let last = performance.now()/1000;
function animate() {
  const t = performance.now()/1000;
  const dt = Math.min(0.04, t-last);
  last = t;

  if(gameStarted && !won){
    const braking = touchLeft && touchRight;
    if(braking){
      heading *= 0.75;
      speed = THREE.MathUtils.lerp(speed, BRAKE_SPEED, 0.22);
    } else {
      if(touchLeft) heading += TURN_SPEED * dt;
      if(touchRight) heading -= TURN_SPEED * dt;
      heading = Math.max(-1.1, Math.min(1.1, heading));
      speed = THREE.MathUtils.lerp(speed, BASE_SPEED, 0.08);
    }

    car.position.x += Math.cos(heading) * speed * dt;
    car.position.z += Math.sin(heading) * speed * dt;
    car.rotation.y = -heading;

    wheels.forEach(w=>w.rotation.x += speed*dt*0.68);

    camera.position.lerp(new THREE.Vector3(
      car.position.x - 4.2 * Math.cos(heading),
      3.8 + Math.sin(t*2.6)*0.6,
      car.position.z - 4.2 * Math.sin(heading)
    ), 0.16);
    camera.lookAt(car.position.x, car.position.y + 2.0, car.position.z);

    speedDisplay.textContent = `Speed: ${Math.round(speed*3.6)} km/h`;

    checkCollision();

    if(car.position.x > 340){
      won = true;
      winOverlay.style.display = 'flex';
      status.textContent = "You made it to the oasis!";
    }

    car.position.z = Math.max(-70, Math.min(70, car.position.z));
  }

  renderer.render(scene, camera);
  requestAnimationFrame(animate);
}

window.addEventListener('resize', ()=>{
  camera.aspect = innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth, innerHeight);
});

animate();
</script>
</body>
</html>
