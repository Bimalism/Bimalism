<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Chain Reaction</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,Arial;
  background:#ffffff;               /* WHITE BACKGROUND */
  color:#111;
  height:100vh;
  overflow:hidden;
}

/* SETTINGS BUTTON */
#settingsBtn{
  position:fixed;
  top:12px;
  left:12px;
  z-index:10;
  padding:10px 14px;
  border:none;
  border-radius:10px;
  background:#000;
  color:#fff;
  font-size:18px;
}

/* SETTINGS OVERLAY */
#settingsOverlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.4);
  display:none;
  align-items:flex-end;
  z-index:20;
}

.settingsBox{
  width:100%;
  max-height:85%;
  background:#f5f5f5;
  border-radius:18px 18px 0 0;
  padding:16px;
  overflow-y:auto;
}

.settingsBox h2{
  text-align:center;
  margin:6px 0 12px;
}

/* SETTING ROW */
.settingRow{
  background:#fff;
  padding:12px;
  border-radius:10px;
  margin-bottom:10px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  border:1px solid #ddd;
}

.settingRow input{
  width:120px;
  padding:6px;
  border-radius:6px;
  border:1px solid #ccc;
}

.settingBtn{
  width:100%;
  padding:12px;
  border:none;
  border-radius:10px;
  margin-top:8px;
  background:#000;
  color:#fff;
  font-size:15px;
}

/* GRID */
.grid-wrap{
  height:100%;
  display:flex;
  justify-content:center;
  align-items:center;
}

.grid{
  display:grid;
  gap:8px;
  padding:12px;
  background:#eee;
  border-radius:16px;
}

.cell{
  width:48px;
  height:48px;
  background:#fff;
  border-radius:10px;
  position:relative;
  border:1px solid #bbb;           /* DIFFERENTIATED BOX */
  box-shadow:0 1px 3px rgba(0,0,0,.15);
}

.orb{
  width:14px;
  height:14px;
  border-radius:50%;
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
}

/* TURN INFO */
#turnInfo{
  position:fixed;
  bottom:10px;
  left:50%;
  transform:translateX(-50%);
  background:#000;
  color:#fff;
  padding:8px 14px;
  border-radius:10px;
  font-weight:bold;
}

/* MOBILE */
@media(max-width:600px){
  .cell{width:38px;height:38px}
}
</style>
</head>

<body>

<button id="settingsBtn">⚙</button>

<div id="settingsOverlay">
  <div class="settingsBox">
    <h2>Game Settings</h2>

    <div class="settingRow">Rows <input id="rows" type="number" value="6"></div>
    <div class="settingRow">Cols <input id="cols" type="number" value="9"></div>
    <div class="settingRow">Players <input id="playerCount" type="number" value="4" min="2" max="10"></div>

    <h3>Player Names</h3>
    <div id="playerNames"></div>

    <button class="settingBtn" id="newGame">Apply & Restart</button>
    <button class="settingBtn" onclick="closeSettings()">Close</button>
  </div>
</div>

<div class="grid-wrap">
  <div class="grid" id="grid"></div>
</div>

<div id="turnInfo">Turn: —</div>

<script>
const COLORS=['#ff3b3b','#3b6cff','#3bff6f','#ffe93b','#b93bff',
'#ff8ad8','#3bfff3','#ff963b','#8aff3b','#000000'];

let ROWS=6,COLS=9;
let players=[],grid=[],current=0;

const gridEl=document.getElementById('grid');

const idx=(c,r)=>r*COLS+c;
const cap=(c,r)=>{
  const edge=c==0||r==0||c==COLS-1||r==ROWS-1;
  const corner=(c==0||c==COLS-1)&&(r==0||r==ROWS-1);
  return corner?2:edge?3:4;
};

function setupPlayers(n){
  players=[];
  for(let i=0;i<n;i++){
    players.push({
      id:i,
      color:COLORS[i],
      name:`Player ${i+1}`
    });
  }
}

function buildNameEditor(){
  playerNames.innerHTML='';
  players.forEach(p=>{
    const row=document.createElement('div');
    row.className='settingRow';
    row.innerHTML=`<span>${p.name}</span>
      <input value="${p.name}" onchange="players[${p.id}].name=this.value; render()">`;
    playerNames.appendChild(row);
  });
}

function setupGrid(){
  gridEl.innerHTML='';
  gridEl.style.gridTemplateColumns=`repeat(${COLS},1fr)`;
  grid=Array(ROWS*COLS).fill().map(()=>({o:-1,c:0}));

  for(let r=0;r<ROWS;r++)for(let c=0;c<COLS;c++){
    const d=document.createElement('div');
    d.className='cell';
    d.onclick=()=>move(c,r);
    gridEl.appendChild(d);
  }
  render();
}

function render(){
  [...gridEl.children].forEach((cell,i)=>{
    cell.innerHTML='';
    const g=grid[i];
    for(let k=0;k<g.c;k++){
      const o=document.createElement('div');
      o.className='orb';
      o.style.background=players[g.o]?.color;
      o.style.transform=`translate(${Math.cos(k)*8}px,${Math.sin(k)*8}px)`;
      cell.appendChild(o);
    }
  });
  turnInfo.textContent=`Turn: ${players[current].name}`;
}

function move(c,r){
  const cell=grid[idx(c,r)];
  if(cell.o!=-1&&cell.o!=current)return;
  explode(c,r,current);
  current=(current+1)%players.length;
  render();
}

function explode(c,r,p){
  const q=[[c,r]];
  grid[idx(c,r)].c++;
  grid[idx(c,r)].o=p;

  while(q.length){
    const [x,y]=q.shift();
    const cell=grid[idx(x,y)];
    if(cell.c>=cap(x,y)){
      cell.c-=cap(x,y);
      if(cell.c<=0)cell.o=-1;
      [[1,0],[-1,0],[0,1],[0,-1]].forEach(([dx,dy])=>{
        const nx=x+dx,ny=y+dy;
        if(nx>=0&&ny>=0&&nx<COLS&&ny<ROWS){
          const n=grid[idx(nx,ny)];
          n.c++;n.o=p;
          if(n.c>=cap(nx,ny))q.push([nx,ny]);
        }
      });
    }
  }
}

function openSettings(){
  buildNameEditor();
  settingsOverlay.style.display='flex';
}
function closeSettings(){settingsOverlay.style.display='none'}

settingsBtn.onclick=openSettings;

newGame.onclick=()=>{
  ROWS=+rows.value;
  COLS=+cols.value;
  setupPlayers(+playerCount.value);
  setupGrid();
  current=0;
  closeSettings();
};

setupPlayers(4);
setupGrid();
</script>
</body>
</html>
